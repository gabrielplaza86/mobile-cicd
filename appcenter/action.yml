name: 'Test Action HW'
description: 'Description for Custom Github action HW'
author: 'MobCICD'

# Define your inputs here.
inputs:
  owner_type:
    description: 'Appcenter app name (as seen in app URL)'
    default: 'organization'
    required: true
  file:
    description: 'Path to android build binary'
    required: true
  destinations:
    description: 'Comma separated list of distribution group names. Default is 'Collaborators', use '*' for all distribution groups'
    default: 'Collaborators'
    required: false
  destination_type:
    description: 'Destination type of distribution destination.'
    default: 'group'
    required: false
  notify_testers:
    description: 'Send email notification about release.'
    default: false
    required: false        
  app_display_name:
    description: 'App display name to use when creating a new app'
    required: false
  app_os:
    description: 'App OS can be Android, iOS, macOS, Windows, Custom'
    required: false
  app_platform:
    description: 'App Platform.'
    required: false
  dsym:
      description: 'Path to your symbols file.'
      required: false
  mapping:
      description: 'Path to your Android mapping.txt'
      required: false
  release_notes:
      description: 'Release notes'
      default: 'No changelog given'
      required: false
  build_number:
      description: 'The build number, required for macOS .pkg and .dmg builds, as well as Android ProGuard mapping.txt when using upload_mapping_only'
      required: false
  version:
      description: 'The build version, required for .pkg, .dmg, .zip and .msi builds, as well as Android ProGuard mapping.txt when using upload_mapping_only'
      required: false
  timeout:
      description: 'Request timeout in seconds applied to individual HTTP requests.'
      required: false
  ruby_version:
    description: 'Ruby version'
    default: '3.3'
    required: false

# Define your outputs here.
outputs:
  time:
    description: 'Your output description here'

runs:
  using: 'composite'
  steps:
    - name: Set utils action path
      id: set-utils-path
      run: |
        action_path=${{ github.action_path }}
        utils_action_path=$(dirname $action_path)/utils
        fastlane_action_path=$(dirname $action_path)/utils/fastlane
        echo "UTILS_ACTION_PATH=${utils_action_path}" >> $GITHUB_ENV
        echo "FASTLANE_ACTION_PATH=${fastlane_action_path}" >> $GITHUB_ENV
      shell: bash

    - uses: ruby/setup-ruby@v1
      with:
        ruby-version: '${{ inputs.ruby_version }}'

    - name: Init fastlane
      id: invoke-appcente-lane
      run: |
        bundle install --quiet
        bundle exec fastlane distribute_to_appcenter \ 
                    owner_type:"${{ inputs.owner_type }}" \
                    app_name:"${{ inputs.app_name }}" \
                    notify_testers:${{ inputs.notify_testers }} \
                    file:"${{ inputs.file }}" \
                    destinations:"${{ inputs.destinations }}"
      shell: bash
      working-directory: ${{ env.FASTLANE_ACTION_PATH }}
      
     


#############################
